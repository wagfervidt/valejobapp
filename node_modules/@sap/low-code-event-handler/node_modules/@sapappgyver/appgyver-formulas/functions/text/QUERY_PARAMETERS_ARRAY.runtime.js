const queryString = require('query-string');
const { formats: { url: urlFormat } } = require('../../formatting');

module.exports = ([url]) => {
  if (urlFormat.matches(url) && typeof url === 'string') {
    const query = Object.assign({}, queryString.parseUrl(url).query);
    const result = [];
    Object.keys(query).forEach((key) => {
      const value = query[key];
      if (Array.isArray(value)) {
        value.forEach((item) => { result.push({ key, value: item }); });
      } else {
        result.push({ key, value });
      }
    });
    return result;
  }
  return null;
};
