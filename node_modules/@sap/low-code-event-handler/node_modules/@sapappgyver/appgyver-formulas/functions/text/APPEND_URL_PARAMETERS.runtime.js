const queryString = require('query-string');
const { formats: { url: urlFormat } } = require('../../formatting');

module.exports = ([baseUrl, params]) => {
  if (baseUrl == null || params == null) {
    return null;
  }
  if (typeof baseUrl !== 'string' || typeof params !== 'object') {
    return null;
  }
  if (!urlFormat.matches(baseUrl)) {
    return null;
  }
  const [path, oldQuery] = baseUrl.split('?');
  const baseUrlFixed = (path[path.length - 1] !== '/') ? `${path}/` : path;
  const newQuery = queryString.stringify(params);
  const joinedQuery = oldQuery ? `${oldQuery}${newQuery ? `&${newQuery}` : ''}` : (newQuery || '');
  return joinedQuery ? `${baseUrlFixed}?${joinedQuery}` : baseUrlFixed;
};
