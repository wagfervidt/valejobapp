const average = require('./AVERAGE.runtime');

const covar = (arr1, arr2) => {
  if (arr1.length !== arr2.length) {
    return null;
  }
  const { length } = arr1;
  if (length <= 0) {
    return null;
  }
  const meanX = average([arr1.slice(0, length)]);
  const meanY = average([arr2.slice(0, length)]);
  let covariance = 0;
  for (let i = 0; i < length; i += 1) {
    covariance += (arr1[i] - meanX) * (arr2[i] - meanY);
  }
  return covariance / length;
};

module.exports = ([array1, array2]) => {
  if (!(Array.isArray(array1) && Array.isArray(array2))) {
    return null;
  }
  const array1Valid = array1.filter(item => (typeof item === 'number' && Number.isFinite(item)));
  const array2Valid = array2.filter(item => (typeof item === 'number' && Number.isFinite(item)));
  const result = covar(array1Valid, array2Valid);
  return Number.isFinite(result) ? result : null;
};
