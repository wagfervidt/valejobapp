const erfc = require('./ERFC.runtime');

const erfcinv = (p) => {
  let err;
  if (p >= 2) {
    return -100;
  }
  if (p <= 0) {
    return 100;
  }
  const pp = (p < 1) ? p : 2 - p;
  const t = Math.sqrt(-2 * Math.log(pp / 2));
  let x = -0.70711 * ((2.30753 + t * 0.27061)
    / (1 + t * (0.99229 + t * 0.04481)) - t);
  for (let j = 0; j < 2; j += 1) {
    err = erfc([x]) - pp;
    x += err / (1.12837916709551257 * Math.exp(-x * x) - x * err);
  }
  return (p < 1) ? x : -x;
};

module.exports = ([num]) => {
  if (num == null) {
    return null;
  }
  if (typeof num === 'number' && Number.isFinite(num)) {
    const result = erfcinv([num]);
    return Number.isFinite(result) ? result : null;
  }
  return null;
};
