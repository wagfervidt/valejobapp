const { numbertoLocaleString, supportedLocales } = require('../../utils/locale');

module.exports = ([value, locale, minDecimalCount, maxDecimalCount]) => {
  if (value == null) {
    return null;
  }
  if (typeof value === 'number' && Number.isFinite(value)
    && typeof minDecimalCount === 'number' && Number.isFinite(minDecimalCount)
    && typeof locale === 'string') {
    let decimalCount;
    if ((maxDecimalCount && typeof maxDecimalCount !== 'number'
      && !Number.isFinite(maxDecimalCount)) || maxDecimalCount > 100 || maxDecimalCount < 0) {
      return null;
    }
    if (minDecimalCount > 100 || minDecimalCount < 0) {
      return null;
    }
    const supportedLocale = supportedLocales;
    if (!supportedLocale.includes(locale)) {
      return null;
    }
    const arrayVal = value.toString().split('.');
    const decimal = arrayVal[1];
    if ((decimal && maxDecimalCount) || (decimal && maxDecimalCount === 0)) {
      decimalCount = decimal.length;
      if (decimal.length >= maxDecimalCount) {
        decimalCount = maxDecimalCount;
      }
      if (decimal.length < minDecimalCount && maxDecimalCount >= minDecimalCount) {
        decimalCount = minDecimalCount;
      }
    } else {
      decimalCount = minDecimalCount;
    }
    const options = {
      decimalCount,
    };
    return numbertoLocaleString(value, locale, options);
  }
  return null;
};
