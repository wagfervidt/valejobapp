const { PMT, FV } = require('../../financial');

module.exports = ([rate, periods, present, first, last, isOnBeginning]) => {
  if (rate == null || periods == null || present == null) {
    return null;
  }

  if (typeof rate !== 'number'
      || !Number.isFinite(rate)
      || typeof periods !== 'number'
      || !Number.isFinite(periods)
      || typeof present !== 'number'
      || !Number.isFinite(present)
      || typeof first !== 'number'
      || !Number.isFinite(first)
      || typeof last !== 'number'
      || !Number.isFinite(last)
      || typeof isOnBeginning !== 'boolean'
  ) {
    return null;
  }
  if (rate <= 0 || periods <= 0 || present <= 0) {
    return null;
  }
  if (first < 1 || last < 1 || first > last) {
    return null;
  }
  const payment = PMT(rate, periods, present, 0, isOnBeginning);
  let start = first;
  let principal = 0;
  if (first === 1) {
    if (isOnBeginning === false) {
      principal = payment + present * rate;
    } else {
      principal = payment;
    }
    // eslint-disable-next-line no-plusplus
    start++;
  }
  // eslint-disable-next-line no-plusplus
  for (let i = start; i <= last; i++) {
    if (isOnBeginning === true) {
      principal += payment - (FV(rate, i - 2, payment, present, 1) - payment) * rate;
    } else {
      principal += payment - FV(rate, i - 1, payment, present, 0) * rate;
    }
  }

  return principal;
};
