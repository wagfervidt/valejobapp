const queryString = require('query-string');
const { formats: { url: urlFormat } } = require('../../formatting');

module.exports = ([value]) => {
  if (urlFormat.matches(value) && typeof value === 'string') {
    const result = Object.assign({}, queryString.parseUrl(value).query);
    return Object.keys(result).reduce((accum, item) => {
      const val = result[item];
      if (Array.isArray(val)) {
        const last = val[val.length - 1];
        // eslint-disable-next-line no-param-reassign
        accum[item] = last;
      } else {
        // eslint-disable-next-line no-param-reassign
        accum[item] = val;
      }
      return accum;
    }, {});
  }
  return null;
};
