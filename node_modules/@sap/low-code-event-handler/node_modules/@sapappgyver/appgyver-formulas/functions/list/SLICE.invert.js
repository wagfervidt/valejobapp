module.exports = (inv) => {
  const { params: [array, start, end], result } = inv;
  if (!Array.isArray(array) || !Array.isArray(result)) {
    throw new Error('SLICE cannot invert a non-list value');
  }
  if (typeof start !== 'number' || (typeof end !== 'number' && end != null)) {
    throw new Error('SLICE cannot invert with non-number indexes');
  }
  const head = array.slice(0, start);
  const tail = end == null ? [] : array.slice(end);
  const slice = end == null ? array.slice(start) : array.slice(start, end);
  if (end != null && (start < 0) === (end < 0) && result.length !== slice.length) {
    throw new Error(`SLICE cannot invert a list with length ${result.length} not matching the slice length ${slice.length}`);
  }
  return inv.invertTo(head.concat(result, tail));
};
