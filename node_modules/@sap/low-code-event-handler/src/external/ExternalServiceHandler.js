const MashupHandler = require('@sap/external-service-mashup');

class ExternalServiceHandler {
  static isExternalEntity(service, definition) {
    if (service && definition) {
      const mashupHandler = new MashupHandler(service);
      const mashupServices = mashupHandler.getTargetServiceNames(definition);
      return mashupServices.length > 0;
    } else {
      return false;
    }
  }

  static async onEntityReadEvent(service, definition, request, next) {
    const mashupHandler = new MashupHandler(service);
    const success = await mashupHandler.init(definition);
    if (success) {
      return mashupHandler.handle(request, next);
    } else {
      return next();
    }
  }

  static async onEntityCUDEvent(service, definition, request, next) {
    const mashupHandler = new MashupHandler(service);
    const success = await mashupHandler.init(definition);
    if (success && mashupHandler.handleCUD){
        return mashupHandler.handleCUD(request, next);
    } else {
      return next();
    }
  }

}

module.exports = ExternalServiceHandler;
