# AppGyver Schemas

This repository is the home for **AppGyver-specific schemas**.

- **[Schema format documentation](./docs/SCHEMA.md)**
- **[Library usage](#library-usage)**
- **[API reference](./docs/API.md)**

**ðŸ“£ NOTE**: Before version 5.0.0 this library was previously released as [`@appgyver/schemas`](https://github.com/AppGyver/schemas). The development continues on this repository as `@sapappgyver/appgyver-schemas`!

## Library usage

To use the utilities in this library:

```bash
npm i --save @sapappgyver/appgyver-schemas
```

You can then start importing the utilities. For example, to check if a schema is assignable to another:

```javascript
const { isSchemaAssignable } = require('@appgyver/formulas/schema');
// Test if the type would be assignable to another

// This logs `false`
console.log(isSchemaAssignable({ type: 'string' }, { type: 'number' }));
// This logs `true`
console.log(isSchemaAssignable({ type: 'string' }, { type: 'string' }));
```

If you need more detailed information about why the assignment is not valid, you can get the validation error messages:

```javascript
const { getSchemaAssignmentErrors } = require('@appgyver/formulas/schema');
// This logs: [{message: 'Text type is not assignable to number type', errors: []}]
console.log(getSchemaAssignmentErrors({ type: 'string' }, { type: 'number' }));
// This logs: []
console.log(getSchemaAssignmentErrors({ type: 'string' }, { type: 'string' }));
```

The errors may provide you deeper information about objects:

```javascript
const schema1 = {
    type: 'object',
    properties: {
        foo: { type: 'string' },
        bar: { type: 'number' },
    },
};
const schema2 = {
    type: 'object',
    properties: {
        foo: { type: 'number' },
        bar: { type: 'boolean' },
    },
};
console.log(getSchemaAssignmentErrors(schema1, schema2));
```

The above example would log the following error structure:

```javascript
[{
    message: 'Unassignable object property "foo"',
    errors: [{
        message: 'Text type is not assignable to number type',
        errors: []
    }]
}, {
    message: 'Unassignable object property "bar"',
    errors: [{
        message: 'Number type is not assignable to true/false',
        errors: []
    }]
}]
```

For full reference for all available functions, [see the API reference](./docs/API.md).

## Type definitions

The functions exported by this library have TypeScript type definitions.
Additionally, there are useful interfaces for schema definitions:

```typescript
import { Schema } from '@sapappgyver/appgyver-schemas';
```

## Development

### Releasing

To release a new version of this package:

1. Ensure `main` branch contains changes you want to release (by merging pull requests)
2. Update [`CHANGELOG.md`](./CHANGELOG.md) to contain change log for the new upcoming version
3. Bump the version number but **do not create a tag** by running one of the following, depending on the nature of your release:
    - `npm version --no-git-tag-version major`
    - `npm version --no-git-tag-version minor`
    - `npm version --no-git-tag-version patch`
4. Commit the changes with a commit message equal to the version number (e.g. `5.0.0`)
5. Push the commit to remote: `git push origin main`
6. Ensure in GitHub that automated tests have passed for the commit
7. Go to [GitHub Releases page](https://github.tools.sap/AppGyver/appgyver-schemas/releases) and create a new release:
    - Create a new tag for the release matching the version number, prefixed with `v` (e.g. `v5.0.0`)
    - The name of the release must be equal to the version tag name (e.g. `v5.0.0`)
    - To the changelog, copy-paste the Markdown from the [`CHANGELOG.md`](./CHANGELOG.md) entry you wrote earlier
8. Automated release pipeline will publish the new version of `@sapappgyver/appgyver-schemas` package
