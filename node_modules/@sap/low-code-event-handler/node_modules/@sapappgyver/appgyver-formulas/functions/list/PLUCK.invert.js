const { invertMap } = require('../../utils/array');
const { invertLookup } = require('../../utils/object');

module.exports = (inv) => {
  const { params: [array, prop], result } = inv;
  if (prop == null) {
    throw new Error('Cannot invert PLUCK with null property');
  }
  const invertedArray = invertMap(array, result, (propValue, item) => (
    invertLookup(item, prop, propValue)
  ));
  return inv.invertTo(invertedArray);
};
