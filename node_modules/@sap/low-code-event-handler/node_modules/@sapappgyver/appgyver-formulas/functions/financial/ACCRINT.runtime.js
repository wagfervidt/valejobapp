const { parseDateTime } = require('../../datetime');
const YEARFRAC = require('../date/YEARFRAC.runtime');

module.exports = ([issue, first, settlement, rate, redemption, frequency, convention]) => {
  if (typeof issue !== 'string' && typeof settlement !== 'string' && typeof first !== 'string') {
    return null;
  }
  const startDate = parseDateTime(issue);
  const endDate = parseDateTime(settlement);
  const firstDate = parseDateTime(first);
  if (startDate.isValid() && endDate.isValid() && firstDate.isValid()) {
    const basis = convention || 'us_nasd';
    const valuesBasis = ['us_nasd', 'actual', 'actual_360', 'actual_365', 'european'];
    if (!valuesBasis.includes(basis)) {
      return null;
    }
    if (![1, 2, 4].includes(frequency)) {
      return null;
    }
    if (rate <= 0 || redemption <= 0) {
      return null;
    }
    if (endDate <= startDate) {
      return null;
    }
    return redemption * rate * YEARFRAC([startDate.format(), endDate.format(), basis]);
  }
  return null;
};
