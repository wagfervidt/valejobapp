const variance = require('./VARIANCE.runtime');
const fDist = require('./F_DIST.runtime');

module.exports = ([array1, array2]) => {
  if (!Array.isArray(array1) || !Array.isArray(array2)) {
    return null;
  }

  const range1 = array1.filter(item => (typeof item === 'number' && Number.isFinite(item)));
  const range2 = array2.filter(item => (typeof item === 'number' && Number.isFinite(item)));
  const variance1 = variance([range1]);
  const variance2 = variance([range2]);
  if (!Number.isFinite(variance1) || !Number.isFinite(variance2)) {
    return null;
  }

  let ratioVariance;
  let degreesTop;
  let degreesLow;

  if (variance1 > variance2) {
    ratioVariance = variance1 / variance2;
    degreesTop = range1.length - 1;
    degreesLow = range2.length - 1;
  } else {
    ratioVariance = variance2 / variance1;
    degreesTop = range2.length - 1;
    degreesLow = range1.length - 1;
  }

  const fDistResult = fDist([ratioVariance, degreesTop, degreesLow, true]);
  if (!Number.isFinite(fDistResult)) {
    return null;
  }
  return 2 * (1 - fDistResult);
};
