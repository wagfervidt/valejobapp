const { parseDateTime } = require('../../datetime');
const YEARFRAC = require('../date/YEARFRAC.runtime');

module.exports = ([settlement, maturity, price]) => {
  if (typeof settlement === 'string' && typeof maturity === 'string'
    && typeof price === 'number' && Number.isFinite(price)) {
    const startMoment = parseDateTime(settlement);
    const endMoment = parseDateTime(maturity);
    if (startMoment.isValid() && endMoment.isValid()) {
      if (price <= 0) {
        return null;
      }
      if (startMoment > endMoment) {
        return null;
      }
      // Return error if maturity is more than one year after settlement
      if (endMoment - startMoment > 365 * 24 * 60 * 60 * 1000) {
        return null;
      }

      return (100 - price) * 360 / (price * (YEARFRAC([settlement, maturity, 'actual_365'])) * 365);
    }
  }
  return null;
};
