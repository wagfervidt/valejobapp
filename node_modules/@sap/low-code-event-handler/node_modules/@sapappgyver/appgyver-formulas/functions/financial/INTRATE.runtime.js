const { parseDateTime } = require('../../datetime');
const YEARFRAC = require('../date/YEARFRAC.runtime');

module.exports = ([buyDate, sellDate, buyPrice, sellPrice, convention]) => {
  if (typeof buyDate !== 'string' && typeof sellDate !== 'string') {
    return null;
  }
  if (typeof buyPrice !== 'number' && !Number.isFinite(buyPrice)
    && typeof sellPrice !== 'number' && !Number.isFinite(sellPrice)) {
    return null;
  }
  if (buyPrice <= 0 || sellPrice <= 0) {
    return null;
  }
  const startDate = parseDateTime(buyDate);
  const endDate = parseDateTime(sellDate);
  if (startDate >= endDate) {
    return null;
  }
  if (startDate.isValid() && endDate.isValid()) {
    const basis = convention || 'us_nasd';
    const valuesBasis = ['us_nasd', 'actual', 'actual_360', 'actual_365', 'european'];
    if (!valuesBasis.includes(basis)) {
      return null;
    }
    const result = ((sellPrice / buyPrice) - 1) / YEARFRAC([buyDate, sellDate, basis]);
    return result;
  }
  return null;
};
