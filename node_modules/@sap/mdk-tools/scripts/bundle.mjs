import * as esbuild from 'esbuild'
import fs from 'node:fs'

 await esbuild.build({
  entryPoints: ['lib/mdkcli_unbundled.js'],
  bundle: true,
  platform: 'node',
  target: ['node16.19'],
  outfile: 'lib/mdkcli.js',
  external: [
    'webpack',
    //below externals are not bundled with/without below list. it's only for indicating dependencies.
    '@nativescript/webpack','ts-patch', 'ts-node', 'typescript', //ts-patch related
    'ts-loader', 'css-loader', 'json-loader','source-map-loader','babel-loader', //loaders
  ],
  minify: true,
  metafile: true  
})

//fs.writeFileSync('meta1.json', JSON.stringify(result1.metafile))


await esbuild.build({
  entryPoints: ['lib/bundler/loaders/fragments-loader/index_unbundled.js'],
  bundle: true,
  platform: 'node',
  target: ['node16.19'],
  outfile: 'lib/bundler/loaders/fragments-loader/index.js',
  external: [],
  minify: true,
  metafile: true  
})
//fs.writeFileSync('meta2.json', JSON.stringify(result2.metafile))