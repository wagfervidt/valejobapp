const { isSame } = require('@sapappgyver/appgyver-schemas/utils/equality');

function transform(obj, mapValue) {
  return Object.keys(obj).reduce((result, propName) => {
    // eslint-disable-next-line no-param-reassign
    result[propName] = mapValue(obj[propName], propName);
    return result;
  }, {});
}

function invertLookup(object, prop, propValue) {
  if (object == null || typeof object !== 'object') {
    throw new Error('Cannot invert a property of non-object');
  }
  const currentValue = object[prop];
  if (isSame(propValue, currentValue)) {
    return object;
  }
  if (Array.isArray(object)) {
    const newArray = object.slice();
    newArray[prop] = propValue;
    return newArray;
  }
  return { ...object, [prop]: propValue };
}

module.exports.invertLookup = invertLookup;
module.exports.transform = transform;
