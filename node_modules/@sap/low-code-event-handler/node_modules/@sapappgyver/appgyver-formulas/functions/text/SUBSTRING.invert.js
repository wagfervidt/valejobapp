module.exports = (inv) => {
  const { params: [text, start, end], result } = inv;
  if (typeof text !== 'string' || typeof result !== 'string') {
    throw new Error('SUBSTRING cannot invert a non-text value');
  }
  if (typeof start !== 'number' || (typeof end !== 'number' && end != null)) {
    throw new Error('SUBSTRING cannot invert with non-number indexes');
  }
  const head = text.slice(0, start);
  const tail = end == null ? '' : text.slice(end);
  const slice = end == null ? text.slice(start) : text.slice(start, end);
  if (end != null && (start < 0) === (end < 0) && result.length !== slice.length) {
    throw new Error(`SUBSTRING cannot invert a text with length ${result.length} not matching the slice length ${slice.length}`);
  }
  return inv.invertTo(`${head}${result}${tail}`);
};
