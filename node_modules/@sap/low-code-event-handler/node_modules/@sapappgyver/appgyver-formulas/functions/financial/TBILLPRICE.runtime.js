const { parseDateTime } = require('../../datetime');
const YEARFRAC = require('../date/YEARFRAC.runtime');

module.exports = ([settlement, maturity, discount]) => {
  if (typeof settlement === 'string' && typeof maturity === 'string'
    && typeof discount === 'number' && Number.isFinite(discount)) {
    const startMoment = parseDateTime(settlement);
    const endMoment = parseDateTime(maturity);
    if (startMoment.isValid() && endMoment.isValid()) {
      if (discount <= 0 || discount >= 1) {
        return null;
      }
      if (startMoment > endMoment) {
        return null;
      }
      // Return error if maturity is more than one year after settlement
      if (endMoment - startMoment > 365 * 24 * 60 * 60 * 1000) {
        return null;
      }

      return 100 * (1 - discount * YEARFRAC([settlement, maturity, 'actual_360']));
    }
  }
  return null;
};
